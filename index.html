<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Analytics Dashboard - Neubrutalism</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #f4f0ff;
        }
        .neubrutalism {
            border: 3px solid black;
            box-shadow: 7px 7px 0px black;
            transition: all 0.2s ease;
        }
        .neubrutalism:hover {
            transform: translate(-3px, -3px);
            box-shadow: 10px 10px 0px black;
        }
        .btn-neubrutalism {
            border: 3px solid black;
            box-shadow: 4px 4px 0px black;
            transition: all 0.2s ease;
        }
        .btn-neubrutalism:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0px black;
        }
        .btn-neubrutalism:active {
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0px black;
        }
        table tr:nth-child(even) {
            background-color: #f8f5ff;
        }
        .table-neubrutalism th {
            border-bottom: 2px solid black;
        }
        .table-neubrutalism td {
            border-bottom: 1px solid #ccc;
        }
        .select-neubrutalism {
            border: 2px solid black;
            box-shadow: 3px 3px 0px black;
            background-color: white;
            padding: 8px 12px;
            border-radius: 0;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='black' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
        }
        .date-neubrutalism {
            border: 2px solid black;
            box-shadow: 3px 3px 0px black;
        }
        .search-neubrutalism {
            border: 2px solid black;
            box-shadow: 3px 3px 0px black;
        }
    </style>
</head>
<body class="p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8">
            <div class="bg-pink-300 p-6 neubrutalism mb-4">
                <h1 class="text-3xl md:text-4xl font-bold">Sales Analytics Dashboard</h1>
                <p class="text-lg mt-2">Real-time data visualization and analysis</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="flex flex-col">
                    <label for="categoryFilter" class="mb-2 font-bold">Category</label>
                    <select id="categoryFilter" class="select-neubrutalism">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="regionFilter" class="mb-2 font-bold">Region</label>
                    <select id="regionFilter" class="select-neubrutalism">
                        <option value="">All Regions</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="searchFilter" class="mb-2 font-bold">Search Products</label>
                    <input type="text" id="searchFilter" placeholder="Type to search..." class="search-neubrutalism p-2">
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-green-200 p-6 neubrutalism">
                <h2 class="text-lg font-bold mb-2">Total Revenue</h2>
                <div id="totalRevenue" class="text-3xl font-bold">$0</div>
            </div>
            <div class="bg-blue-200 p-6 neubrutalism">
                <h2 class="text-lg font-bold mb-2">Total Sales</h2>
                <div id="totalSales" class="text-3xl font-bold">0</div>
            </div>
            <div class="bg-yellow-200 p-6 neubrutalism">
                <h2 class="text-lg font-bold mb-2">Avg. Revenue Per Sale</h2>
                <div id="avgRevenue" class="text-3xl font-bold">$0</div>
            </div>
            <div class="bg-purple-200 p-6 neubrutalism">
                <h2 class="text-lg font-bold mb-2">Total Products</h2>
                <div id="uniqueProducts" class="text-3xl font-bold">0</div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white p-6 neubrutalism">
                <h2 class="text-xl font-bold mb-4">Sales by Category</h2>
                <canvas id="categoryChart" height="300"></canvas>
            </div>
            <div class="bg-white p-6 neubrutalism">
                <h2 class="text-xl font-bold mb-4">Regional Distribution</h2>
                <canvas id="regionChart" height="300"></canvas>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white p-6 neubrutalism">
                <h2 class="text-xl font-bold mb-4">Monthly Sales Trend</h2>
                <canvas id="timeChart" height="300"></canvas>
            </div>
            <div class="bg-white p-6 neubrutalism">
                <h2 class="text-xl font-bold mb-4">Top Products</h2>
                <canvas id="productChart" height="300"></canvas>
            </div>
        </div>

        <div class="bg-white p-6 neubrutalism overflow-x-auto mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                <h2 class="text-xl font-bold">Transaction Details</h2>
                <div class="flex flex-col md:flex-row gap-2 mt-2 md:mt-0">
                    <div>
                        <label for="entriesPerPage" class="mr-2">Show</label>
                        <select id="entriesPerPage" class="select-neubrutalism py-1 px-2">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                    <button id="exportCSV" class="bg-green-300 py-2 px-4 btn-neubrutalism">
                        <i class="bi bi-download mr-1"></i> Export
                    </button>
                </div>
            </div>
            
            <table class="w-full min-w-[800px] table-neubrutalism">
                <thead>
                    <tr class="bg-gray-100">
                        <th class="p-2 text-left cursor-pointer" data-sort="date">
                            Date <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th class="p-2 text-left cursor-pointer" data-sort="product">
                            Product <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th class="p-2 text-left cursor-pointer" data-sort="category">
                            Category <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th class="p-2 text-left cursor-pointer" data-sort="sales">
                            Sales <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th class="p-2 text-left cursor-pointer" data-sort="revenue">
                            Revenue <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th class="p-2 text-left cursor-pointer" data-sort="region">
                            Region <i class="bi bi-arrow-down-up"></i>
                        </th>
                    </tr>
                </thead>
                <tbody id="transactionTable"></tbody>
            </table>
            
            <div class="flex justify-between items-center mt-4">
                <div id="tableInfo" class="text-sm text-gray-600">Showing 0 to 0 of 0 entries</div>
                <div class="flex gap-2">
                    <button id="prevPage" class="bg-gray-200 py-1 px-3 btn-neubrutalism">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <button id="nextPage" class="bg-gray-200 py-1 px-3 btn-neubrutalism">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <footer class="text-center p-6 bg-gray-100 neubrutalism">
            <p>Sales Analytics Dashboard Â© 2024 | Data refreshed: <span id="lastUpdated"></span></p>
        </footer>
    </div>

    <script>
        const CSV_URL = 'https://db.zetaverse.one/storage/v1/object/public/app-uploads/spreadsheet-1742776401961/3G13ElSfYeXjHYnA1xrXK9HPAl12/j1q14wy1.csv';
        
        // State management
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        let entriesPerPage = 10;
        let currentSort = { column: 'date', direction: 'desc' };
        
        // Elements
        const elements = {
            totalRevenue: document.getElementById('totalRevenue'),
            totalSales: document.getElementById('totalSales'),
            avgRevenue: document.getElementById('avgRevenue'),
            uniqueProducts: document.getElementById('uniqueProducts'),
            transactionTable: document.getElementById('transactionTable'),
            categoryFilter: document.getElementById('categoryFilter'),
            regionFilter: document.getElementById('regionFilter'),
            searchFilter: document.getElementById('searchFilter'),
            tableInfo: document.getElementById('tableInfo'),
            entriesPerPage: document.getElementById('entriesPerPage'),
            prevPage: document.getElementById('prevPage'),
            nextPage: document.getElementById('nextPage'),
            exportCSV: document.getElementById('exportCSV'),
            lastUpdated: document.getElementById('lastUpdated')
        };
        
        // Load data
        async function loadData() {
            try {
                const response = await fetch(CSV_URL);
                const csvData = await response.text();
                
                Papa.parse(csvData, {
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        allData = results.data.map(row => ({
                            ...row,
                            Revenue: typeof row.Revenue === 'number' ? row.Revenue : parseFloat(row.Revenue || 0),
                            Sales: typeof row.Sales === 'number' ? row.Sales : parseInt(row.Sales || 0)
                        }));
                        
                        // Set last updated time
                        elements.lastUpdated.textContent = new Date().toLocaleString();
                        
                        // Initialize the app
                        initializeApp();
                    },
                    error: function(error) {
                        console.error('Error parsing CSV:', error);
                    }
                });
            } catch (error) {
                console.error('Error loading CSV:', error);
            }
        }
        
        function initializeApp() {
            // Populate filters
            populateFilters();
            
            // Initial filter application
            applyFilters();
            
            // Add event listeners
            setupEventListeners();
            
            // Sort headers setup
            setupSortHeaders();
        }
        
        function populateFilters() {
            // Get unique categories
            const categories = [...new Set(allData.map(item => item.Category))].filter(Boolean).sort();
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                elements.categoryFilter.appendChild(option);
            });
            
            // Get unique regions
            const regions = [...new Set(allData.map(item => item.Region))].filter(Boolean).sort();
            regions.forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                elements.regionFilter.appendChild(option);
            });
        }
        
        function setupEventListeners() {
            // Filter change events
            elements.categoryFilter.addEventListener('change', () => {
                currentPage = 1;
                applyFilters();
            });
            
            elements.regionFilter.addEventListener('change', () => {
                currentPage = 1;
                applyFilters();
            });
            
            elements.searchFilter.addEventListener('input', () => {
                currentPage = 1;
                applyFilters();
            });
            
            // Pagination
            elements.prevPage.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                }
            });
            
            elements.nextPage.addEventListener('click', () => {
                const totalPages = Math.ceil(filteredData.length / entriesPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                }
            });
            
            // Entries per page
            elements.entriesPerPage.addEventListener('change', () => {
                entriesPerPage = parseInt(elements.entriesPerPage.value);
                currentPage = 1;
                renderTable();
            });
            
            // Export CSV
            elements.exportCSV.addEventListener('click', exportFilteredData);
        }
        
        function setupSortHeaders() {
            document.querySelectorAll('th[data-sort]').forEach(header => {
                header.addEventListener('click', () => {
                    const column = header.getAttribute('data-sort');
                    if (currentSort.column === column) {
                        // Toggle direction if same column
                        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        // New column, default to descending
                        currentSort.column = column;
                        currentSort.direction = 'desc';
                    }
                    
                    // Update visuals
                    document.querySelectorAll('th i').forEach(icon => {
                        icon.className = 'bi bi-arrow-down-up';
                    });
                    
                    const icon = header.querySelector('i');
                    icon.className = currentSort.direction === 'asc' 
                        ? 'bi bi-arrow-up' 
                        : 'bi bi-arrow-down';
                    
                    // Re-render with new sort
                    sortData();
                    renderTable();
                });
            });
        }
        
        function applyFilters() {
            const categoryFilter = elements.categoryFilter.value;
            const regionFilter = elements.regionFilter.value;
            const searchFilter = elements.searchFilter.value.toLowerCase();
            
            filteredData = allData.filter(item => {
                const matchesCategory = !categoryFilter || item.Category === categoryFilter;
                const matchesRegion = !regionFilter || item.Region === regionFilter;
                const matchesSearch = !searchFilter || 
                    (item.Product && item.Product.toString().toLowerCase().includes(searchFilter));
                
                return matchesCategory && matchesRegion && matchesSearch;
            });
            
            // Sort data
            sortData();
            
            // Update metrics
            updateMetrics();
            
            // Render charts
            renderCharts();
            
            // Render table
            renderTable();
        }
        
        function sortData() {
            filteredData.sort((a, b) => {
                let valueA = a[currentSort.column];
                let valueB = b[currentSort.column];
                
                // Handle null/undefined values
                if (valueA === null || valueA === undefined) valueA = '';
                if (valueB === null || valueB === undefined) valueB = '';
                
                // Compare based on data type
                let comparison = 0;
                if (typeof valueA === 'number' && typeof valueB === 'number') {
                    comparison = valueA - valueB;
                } else {
                    valueA = valueA.toString();
                    valueB = valueB.toString();
                    comparison = valueA.localeCompare(valueB);
                }
                
                // Apply sort direction
                return currentSort.direction === 'asc' ? comparison : -comparison;
            });
        }
        
        function updateMetrics() {
            if (filteredData.length === 0) {
                elements.totalRevenue.textContent = '$0';
                elements.totalSales.textContent = '0';
                elements.avgRevenue.textContent = '$0';
                elements.uniqueProducts.textContent = '0';
                return;
            }
            
            // Calculate metrics
            const totalRevenue = filteredData.reduce((sum, item) => sum + (item.Revenue || 0), 0);
            const totalSales = filteredData.reduce((sum, item) => sum + (item.Sales || 0), 0);
            const avgRevenue = totalSales > 0 ? totalRevenue / totalSales : 0;
            const uniqueProducts = new Set(filteredData.map(item => item.Product)).size;
            
            // Update UI
            elements.totalRevenue.textContent = `$${totalRevenue.toLocaleString('en-US', {maximumFractionDigits:2})}`;
            elements.totalSales.textContent = totalSales.toLocaleString('en-US');
            elements.avgRevenue.textContent = `$${avgRevenue.toLocaleString('en-US', {maximumFractionDigits:2})}`;
            elements.uniqueProducts.textContent = uniqueProducts.toLocaleString('en-US');
        }
        
        function renderTable() {
            elements.transactionTable.innerHTML = '';
            
            const startIndex = (currentPage - 1) * entriesPerPage;
            const endIndex = Math.min(startIndex + entriesPerPage, filteredData.length);
            
            // Update table info
            elements.tableInfo.textContent = `Showing ${filteredData.length > 0 ? startIndex + 1 : 0} to ${endIndex} of ${filteredData.length} entries`;
            
            // Disable/enable pagination buttons
            elements.prevPage.disabled = currentPage === 1;
            elements.prevPage.classList.toggle('opacity-50', currentPage === 1);
            
            const totalPages = Math.ceil(filteredData.length / entriesPerPage);
            elements.nextPage.disabled = currentPage >= totalPages;
            elements.nextPage.classList.toggle('opacity-50', currentPage >= totalPages);
            
            // Add table rows
            const displayData = filteredData.slice(startIndex, endIndex);
            displayData.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="p-2">${item.Date || '-'}</td>
                    <td class="p-2">${item.Product || '-'}</td>
                    <td class="p-2">${item.Category || '-'}</td>
                    <td class="p-2">${(item.Sales || 0).toLocaleString('en-US')}</td>
                    <td class="p-2">$${(item.Revenue || 0).toLocaleString('en-US', {maximumFractionDigits:2})}</td>
                    <td class="p-2">${item.Region || '-'}</td>
                `;
                elements.transactionTable.appendChild(tr);
            });
        }
        
        function renderCharts() {
            // Process data for charts
            const categoryData = {};
            const regionData = {};
            const monthlyData = {};
            const productData = {};
            
            filteredData.forEach(item => {
                // Category chart data
                if (item.Category) {
                    categoryData[item.Category] = (categoryData[item.Category] || 0) + (item.Revenue || 0);
                }
                
                // Region chart data
                if (item.Region) {
                    regionData[item.Region] = (regionData[item.Region] || 0) + (item.Revenue || 0);
                }
                
                // Monthly chart data
                if (item.Date) {
                    const date = new Date(item.Date);
                    if (!isNaN(date.getTime())) {
                        const monthYear = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                        monthlyData[monthYear] = (monthlyData[monthYear] || 0) + (item.Sales || 0);
                    }
                }
                
                // Product chart data
                if (item.Product) {
                    productData[item.Product] = (productData[item.Product] || 0) + (item.Revenue || 0);
                }
            });
            
            // Sort and limit product data to top 5
            const topProducts = Object.entries(productData)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .reduce((obj, [key, value]) => {
                    obj[key] = value;
                    return obj;
                }, {});
            
            // Category Chart
            createPieChart('categoryChart', categoryData, 
                'Sales by Category',
                ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40']);
            
            // Region Chart
            createPieChart('regionChart', regionData, 
                'Regional Distribution',
                ['#4BC0C0', '#FF6384', '#FFCE56', '#36A2EB', '#9966FF', '#FF9F40']);
            
            // Time Chart
            createTimeChart('timeChart', monthlyData);
            
            // Product Chart
            createBarChart('productChart', topProducts, 'Top Products by Revenue');
        }
        
        function createPieChart(canvasId, data, label, colors) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            // Destroy previous chart if exists
            if (window[canvasId + 'Chart'] instanceof Chart) {
                window[canvasId + 'Chart'].destroy();
            }
            
            // Prepare data
            const labels = Object.keys(data);
            const values = Object.values(data);
            
            // Create chart
            window[canvasId + 'Chart'] = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: 'black'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: "'Space Grotesk', sans-serif",
                                    size: 12
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: label,
                            font: {
                                family: "'Space Grotesk', sans-serif",
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: $${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function createTimeChart(canvasId, data) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            // Destroy previous chart if exists
            if (window[canvasId + 'Chart'] instanceof Chart) {
                window[canvasId + 'Chart'].destroy();
            }
            
            // Sort dates
            const sortedLabels = Object.keys(data).sort();
            const sortedValues = sortedLabels.map(key => data[key]);
            
            // Create chart
            window[canvasId + 'Chart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedLabels.map(date => {
                        const [year, month] = date.split('-');
                        return `${month}/${year}`;
                    }),
                    datasets: [{
                        label: 'Monthly Sales',
                        data: sortedValues,
                        fill: false,
                        borderColor: '#4BC0C0',
                        backgroundColor: '#4BC0C0',
                        tension: 0.1,
                        borderWidth: 3,
                        pointBackgroundColor: 'black',
                        pointBorderColor: 'black',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Monthly Sales Trend',
                            font: {
                                family: "'Space Grotesk', sans-serif",
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: "'Space Grotesk', sans-serif"
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    family: "'Space Grotesk', sans-serif"
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function createBarChart(canvasId, data, label) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            // Destroy previous chart if exists
            if (window[canvasId + 'Chart'] instanceof Chart) {
                window[canvasId + 'Chart'].destroy();
            }
            
            // Prepare data
            const labels = Object.keys(data);
            const values = Object.values(data);
            
            // Create chart
            window[canvasId + 'Chart'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Revenue',
                        data: values,
                        backgroundColor: '#9966FF',
                        borderColor: 'black',
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: label,
                            font: {
                                family: "'Space Grotesk', sans-serif",
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    return `Revenue: $${value.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                },
                                font: {
                                    family: "'Space Grotesk', sans-serif"
                                }
                            }
                        },
                        y: {
                            ticks: {
                                font: {
                                    family: "'Space Grotesk', sans-serif"
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function exportFilteredData() {
            // Create CSV content
            const headers = ['Date', 'Product', 'Category', 'Sales', 'Revenue', 'Region'];
            let csvContent = headers.join(',') + '\n';
            
            filteredData.forEach(item => {
                const row = headers.map(header => {
                    const value = item[header];
                    // Handle strings with commas by wrapping in quotes
                    if (typeof value === 'string' && value.includes(',')) {
                        return `"${value}"`;
                    }
                    return value;
                });
                csvContent += row.join(',') + '\n';
            });
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'sales_data_export.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Load data when DOM is fully loaded
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
<script>document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
	</body>
</html>